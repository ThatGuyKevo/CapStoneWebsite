{"ast":null,"code":"import _regeneratorRuntime from\"/Users/thatguykev/Desktop/Git/CapStoneWebsite/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/thatguykev/Desktop/Git/CapStoneWebsite/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/thatguykev/Desktop/Git/CapStoneWebsite/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState}from\"react\";import{useStripe,useElements,CardElement,Elements}from\"@stripe/react-stripe-js\";import{Button}from\"react-bootstrap\";import Axios from\"axios\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function CheckoutForm(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),processing=_useState2[0],setProcessing=_useState2[1];var stripe=useStripe();var elements=useElements();var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(event){var _yield$Axios,data,clientSecret,result;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:event.preventDefault();if(!(!stripe||!elements)){_context.next=3;break;}return _context.abrupt(\"return\");case 3:setProcessing(true);_context.next=6;return Axios(\"/api/stripe/secret/\".concat(props.orderId));case 6:_yield$Axios=_context.sent;data=_yield$Axios.data;clientSecret=data.client_secret;_context.next=11;return stripe.confirmCardPayment(clientSecret,{payment_method:{card:elements.getElement(CardElement),billing_details:{name:data.order.user.name,email:data.order.user.email}}});case 11:result=_context.sent;if(result.error){console.log(result.error.message);alert(result.error.message);}else{if(result.paymentIntent.status===\"succeeded\"){props.handleSuccessPayment(result.paymentIntent);console.log(result.paymentIntent);}}setProcessing(false);case 14:case\"end\":return _context.stop();}}},_callee);}));return function handleSubmit(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(CardElement,{}),/*#__PURE__*/_jsx(Button,{type:\"submit\",className:\"btn-block\",disabled:!stripe||processing,children:\"Pay With Stripe\"})]});}var StripeCheckout=function StripeCheckout(props){return/*#__PURE__*/_jsx(Elements,{stripe:props.stripe,children:/*#__PURE__*/_jsx(CheckoutForm,{orderId:props.orderId,handleSuccessPayment:props.handleSuccessPayment})});};export default StripeCheckout;","map":{"version":3,"names":["React","useState","useStripe","useElements","CardElement","Elements","Button","Axios","CheckoutForm","props","processing","setProcessing","stripe","elements","handleSubmit","event","preventDefault","orderId","data","clientSecret","client_secret","confirmCardPayment","payment_method","card","getElement","billing_details","name","order","user","email","result","error","console","log","message","alert","paymentIntent","status","handleSuccessPayment","StripeCheckout"],"sources":["/Users/thatguykev/Desktop/Git/CapStoneWebsite/client/src/components/StripeCheckout.js"],"sourcesContent":["import React, { useState } from \"react\";\nimport {\n  useStripe,\n  useElements,\n  CardElement,\n  Elements,\n} from \"@stripe/react-stripe-js\";\nimport { Button } from \"react-bootstrap\";\nimport Axios from \"axios\";\n\nfunction CheckoutForm(props) {\n  const [processing, setProcessing] = useState(false);\n  const stripe = useStripe();\n  const elements = useElements();\n\n  const handleSubmit = async (event) => {\n    event.preventDefault();\n\n    if (!stripe || !elements) {\n      return;\n    }\n    setProcessing(true);\n    const { data } = await Axios(`/api/stripe/secret/${props.orderId}`);\n    const clientSecret = data.client_secret;\n\n    const result = await stripe.confirmCardPayment(clientSecret, {\n      payment_method: {\n        card: elements.getElement(CardElement),\n        billing_details: {\n          name: data.order.user.name,\n          email: data.order.user.email,\n        },\n      },\n    });\n\n    if (result.error) {\n      console.log(result.error.message);\n      alert(result.error.message);\n    } else {\n      if (result.paymentIntent.status === \"succeeded\") {\n        props.handleSuccessPayment(result.paymentIntent);\n        console.log(result.paymentIntent);\n      }\n    }\n    setProcessing(false);\n  };\n\n  return (\n    <form onSubmit={handleSubmit}>\n      <CardElement />\n\n      <Button\n        type=\"submit\"\n        className=\"btn-block\"\n        disabled={!stripe || processing}>\n        Pay With Stripe\n      </Button>\n    </form>\n  );\n}\n\nconst StripeCheckout = (props) => (\n  <Elements stripe={props.stripe}>\n    <CheckoutForm\n      orderId={props.orderId}\n      handleSuccessPayment={props.handleSuccessPayment}\n    />\n  </Elements>\n);\nexport default StripeCheckout;\n"],"mappings":"8aAAA,MAAOA,MAAP,EAAgBC,QAAhB,KAAgC,OAAhC,CACA,OACEC,SADF,CAEEC,WAFF,CAGEC,WAHF,CAIEC,QAJF,KAKO,yBALP,CAMA,OAASC,MAAT,KAAuB,iBAAvB,CACA,MAAOC,MAAP,KAAkB,OAAlB,C,wFAEA,QAASC,aAAT,CAAsBC,KAAtB,CAA6B,CAC3B,cAAoCR,QAAQ,CAAC,KAAD,CAA5C,wCAAOS,UAAP,eAAmBC,aAAnB,eACA,GAAMC,OAAM,CAAGV,SAAS,EAAxB,CACA,GAAMW,SAAQ,CAAGV,WAAW,EAA5B,CAEA,GAAMW,aAAY,4FAAG,iBAAOC,KAAP,8JACnBA,KAAK,CAACC,cAAN,GADmB,KAGf,CAACJ,MAAD,EAAW,CAACC,QAHG,kEAMnBF,aAAa,CAAC,IAAD,CAAb,CANmB,sBAOIJ,MAAK,8BAAuBE,KAAK,CAACQ,OAA7B,EAPT,mCAOXC,IAPW,cAOXA,IAPW,CAQbC,YARa,CAQED,IAAI,CAACE,aARP,wBAUER,OAAM,CAACS,kBAAP,CAA0BF,YAA1B,CAAwC,CAC3DG,cAAc,CAAE,CACdC,IAAI,CAAEV,QAAQ,CAACW,UAAT,CAAoBpB,WAApB,CADQ,CAEdqB,eAAe,CAAE,CACfC,IAAI,CAAER,IAAI,CAACS,KAAL,CAAWC,IAAX,CAAgBF,IADP,CAEfG,KAAK,CAAEX,IAAI,CAACS,KAAL,CAAWC,IAAX,CAAgBC,KAFR,CAFH,CAD2C,CAAxC,CAVF,SAUbC,MAVa,eAoBnB,GAAIA,MAAM,CAACC,KAAX,CAAkB,CAChBC,OAAO,CAACC,GAAR,CAAYH,MAAM,CAACC,KAAP,CAAaG,OAAzB,EACAC,KAAK,CAACL,MAAM,CAACC,KAAP,CAAaG,OAAd,CAAL,CACD,CAHD,IAGO,CACL,GAAIJ,MAAM,CAACM,aAAP,CAAqBC,MAArB,GAAgC,WAApC,CAAiD,CAC/C5B,KAAK,CAAC6B,oBAAN,CAA2BR,MAAM,CAACM,aAAlC,EACAJ,OAAO,CAACC,GAAR,CAAYH,MAAM,CAACM,aAAnB,EACD,CACF,CACDzB,aAAa,CAAC,KAAD,CAAb,CA7BmB,uDAAH,kBAAZG,aAAY,4CAAlB,CAgCA,mBACE,cAAM,QAAQ,CAAEA,YAAhB,wBACE,KAAC,WAAD,IADF,cAGE,KAAC,MAAD,EACE,IAAI,CAAC,QADP,CAEE,SAAS,CAAC,WAFZ,CAGE,QAAQ,CAAE,CAACF,MAAD,EAAWF,UAHvB,6BAHF,GADF,CAYD,CAED,GAAM6B,eAAc,CAAG,QAAjBA,eAAiB,CAAC9B,KAAD,qBACrB,KAAC,QAAD,EAAU,MAAM,CAAEA,KAAK,CAACG,MAAxB,uBACE,KAAC,YAAD,EACE,OAAO,CAAEH,KAAK,CAACQ,OADjB,CAEE,oBAAoB,CAAER,KAAK,CAAC6B,oBAF9B,EADF,EADqB,EAAvB,CAQA,cAAeC,eAAf"},"metadata":{},"sourceType":"module"}